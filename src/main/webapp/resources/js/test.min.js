+$(function() {
	// 严格模式
	"use strict";
	var sContextPath = rms.getContextPath();

	var aslocation = location.href.split("/");

	
	//编辑模态验证
    var oValidator;
  
	// 画面初期事件绑定及JS插件渲染
	function initPageComponent() {
		
		$("#add").click(function(){
			$("#validModel").modal();
			$("#addModel").modal();
			});
		$("#edit").click(function(){
			$("#validModel").modal();
			$("#editModel").modal();
			});
		
		
	$("#validConfirm").click(function(){
			
			if (!$("#validForm").valid()) {
				return false;
			}
			var bSuccess = false;
			var oAjaxOption = {
				type : "post",
				url : sContextPath + "/rest/permission/permissionValid.json",
				data : $("#validForm").form2json(),
				dataType : "json",
				contentType: "application/json",
				success : function(oData, oStatus) {
					rms.showSuccess("I004");
					bSuccess = true;
				},
				error : function(oData, oStatus, eErrorThrow) {
					rms.handleRemoteError(oData, oStatus,
							eErrorThrow);
				},
				complete : function(oXmlHttpRequest, oStatus) {
					$.unblockUI();
					if (bSuccess) {
						$("#validModel").modal('hide');
					}
				}
			};
			$.blockUI(rms.getBlockOption());
			$.ajax(oAjaxOption);
		});
	
	
	// 获取所有的功能信息
	function getLinkData() {

		var oAjaxOption = {
			type : "get",
			url : sContextPath + "/rest/permission/permission.json",
			contentType : "application/json",
			dataType : "json",
			success : function(oData, oStatus) {
				setLinkData(oData, oStatus);
				
			},
			error : function(oData, oStatus, eErrorThrow) {
				rms.handleRemoteError(oData, oStatus, eErrorThrow);
			},
			complete : function(oXmlHttpRequest, oStatus) {
				$.unblockUI();
			}
		};
		$.blockUI(rms.getBlockOption());
		$.ajax(oAjaxOption);
	}

	// 设置树形链接
	function setLinkData(oData, oStatus) {
		thisData=oData.data;
		$("#div-link")
				.append(
						'<div class="permission"><div class="box">'
								+ '<a class="a-link" href="'
								+ sContextPath
								+ '/permission/query"  title="'
								+ oData.permissionName
								+ '">'
								+ oData.permissionName
								+ '</a>'
								+ '<div class="div-btn-first">'
								+ '<a href="javascript:;" class="btn btn-primary" data-click="add" data-click-data="0"><i class="fa fa-plus"></i> </a> '
								+ '</div></div></div>');

		$
				.each(
						oData.data,
						function(n, value) {
							var sParentUuid;
							if (value.parentUuid == null) {
								sParentUuid = "0";
							} else {
								sParentUuid = value.parentUuid;
							}
							var sHtml = '<div class="permission">';
							var i = 1;
							var iLengthIndex = value.orgaRelaIndex.length / 21;
							for (i = 1; i <= iLengthIndex; i++) {
								sHtml = sHtml
										+ '<span class="span-tab"></span>';
							}
							sHtml = sHtml + '<div class="box">';

							if (sPermissionUuid != value.uuid) {
								sHtml = sHtml
										+ '<a class="a-link" title="'
										+ value.permissionName
										+ '" href="'
										+ sContextPath
										+ '/rest/permission/qyeryQermission.json'
										+ value.uuid + '">';

							} else {
								sHtml = sHtml
										+ '<a class="current a-link" title="'
										+ value.permissionName
										+ '"  href="javascript:;">';
							}
							sHtml = sHtml + '&#9492&nbsp;'
									+ value.permissionName
									+ '</a><div class="div-btn">';
							sHtml = sHtml
									+ '<a href="javascript:;" class="btn btn-primary" data-click="edit" data-click-data="'
									+ value.uuid
									+ '" data-click-data-row="'+n+'"><i class="fa fa-pencil"></i> </a> '
									+ ' <a href="javascript:;" class="btn btn-danger" data-click="delete" data-click-data="'
									+ sParentUuid
									+ '" data-click-data2="'
									+ value.uuid
									+ 'data-click-data-row="'+n+'"><i class="fa fa-trash"></i> </a> '
									+ ' <a href="javascript:;" class="btn btn-primary" data-click="add" data-click-data="'
									+ value.uuid
									+ '"><i class="fa fa-plus"></i> </a> ';
							sHtml = sHtml + '</div></div>';
							$("#div-link").append(sHtml);

						});
	}
	
	// 画面初期化
	function pageOnLoad() {

		getLinkData();// 获取所有功能信息
		// 画面初期事件绑定及JS插件渲染
		initPageComponent();

	}
	// =================================== 方法执行
	// =================================== //
	// 画面初期化
	pageOnLoad();
});